cmake_minimum_required(VERSION 3.10)

set(DIR ${FL_CORE_DIR}/test)
set(LIBS flashlight ${CMAKE_DL_LIBS})
build_test(${DIR}/autograd/AutogradTest.cpp ${LIBS} "" ON)
build_test(${DIR}/common/DevicePtrTest.cpp ${LIBS} "" ON)
build_test(${DIR}/common/DynamicBenchmarkTest.cpp ${LIBS} "" ON)
build_test(${DIR}/common/HistogramTest.cpp ${LIBS} "" ON)
build_test(${DIR}/common/LoggingTest.cpp ${LIBS} "" ON)
build_test(${DIR}/common/SerializationTest.cpp ${LIBS} "" ON)
build_test(${DIR}/optim/OptimTest.cpp ${LIBS} "" ON)
build_test(${DIR}/memory/CachingMemoryManagerTest.cpp ${LIBS} "" OFF)
build_test(${DIR}/memory/MemoryFrameworkTest.cpp ${LIBS} "" ON)
build_test(${DIR}/memory/MemoryInitTest.cpp ${LIBS} "" ON)
build_test(${DIR}/nn/ModuleTest.cpp ${LIBS} "" ON)
build_test(${DIR}/nn/NNSerializationTest.cpp ${LIBS} "" ON)
build_test(${DIR}/nn/NNUtilsTest.cpp ${LIBS} "" ON)
build_test(${DIR}/dataset/DatasetTest.cpp ${LIBS} "" ON)
build_test(${DIR}/dataset/DatasetUtilsTest.cpp ${LIBS} "" ON)
build_test(${DIR}/meter/MeterTest.cpp ${LIBS} "" ON)
if (FL_BUILD_DISTRIBUTED)
  build_test(${DIR}/distributed/AllReduceTest.cpp ${LIBS} "" OFF)
endif ()
if (FL_BUILD_CONTRIB)
  build_test(${DIR}/contrib/modules/ContribModuleTest.cpp ${LIBS} "" ON)
  build_test(${DIR}/contrib/modules/ContribSerializationTest.cpp ${LIBS} "" ON)
endif ()
